<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1"><meta name=generator content="Hugo 0.98.0"><meta name=generator content="Relearn 3.4.1"><meta name=description content><meta name=author content="Choria Project"><title>Choria Async Jobs :: Choria Async Jobs Documentation</title><link rel=alternate type=application/rss+xml href=https://choria-io.github.io/asyncjobs/index.xml title="Choria Async Jobs Documentation"><link rel=alternate type=application/json href=https://choria-io.github.io/asyncjobs/index.json title="Choria Async Jobs Documentation"><link href=https://choria-io.github.io/asyncjobs/css/nucleus.css?1654500095 rel=stylesheet><link href=https://choria-io.github.io/asyncjobs/css/fontawesome-all.min.css?1654500095 rel=stylesheet><link href=https://choria-io.github.io/asyncjobs/css/featherlight.min.css?1654500095 rel=stylesheet><link href=https://choria-io.github.io/asyncjobs/css/perfect-scrollbar.min.css?1654500095 rel=stylesheet><link href=https://choria-io.github.io/asyncjobs/css/auto-complete.css?1654500095 rel=stylesheet><link href=https://choria-io.github.io/asyncjobs/css/theme.css?1654500095 rel=stylesheet><link href=https://choria-io.github.io/asyncjobs/css/theme-asyncjobs.css?1654500095 rel=stylesheet id=variant-style><link href=https://choria-io.github.io/asyncjobs/css/variant.css?1654500095 rel=stylesheet><link href=https://choria-io.github.io/asyncjobs/css/print.css?1654500095 rel=stylesheet media=print><style>:not(pre)>code.copy-to-clipboard-code+span.copy-to-clipboard-button{display:none}:not(pre)>code.copy-to-clipboard-code{border-bottom-right-radius:2px;border-top-right-radius:2px;border-right-width:1px}</style><script src=https://choria-io.github.io/asyncjobs/js/variant.js?1654500095></script>
<script>var index_url="https://choria-io.github.io/asyncjobs/index.json",baseUriFull,root_url="https://choria-io.github.io/asyncjobs/",baseUri=root_url.replace(/\/$/,'');window.T_Copy_to_clipboard="Copy to clipboard",window.T_Copied_to_clipboard="Copied to clipboard!",window.T_Copy_link_to_clipboard="Copy link to clipboard",window.T_Link_copied_to_clipboard="Copied link to clipboard!",baseUriFull="https://choria-io.github.io/asyncjobs/",variants.init(["asyncjobs"])</script><script src=https://choria-io.github.io/asyncjobs/js/jquery.min.js?1654500095></script></head><body class=mobile-support data-url=https://choria-io.github.io/asyncjobs/><div id=body class=default-animation><div id=sidebar-overlay></div><div id=toc-overlay></div><nav id=topbar class=highlightable><div><div class=navigation><a class="nav nav-next" href=https://choria-io.github.io/asyncjobs/overview/ title=Overviews><i class="fas fa-chevron-right fa-fw"></i></a></div><div class=navigation><span class="nav nav-prev"><i class="fa fa-chevron-left fa-fw"></i></span></div><div id=breadcrumbs><span id=sidebar-toggle-span><a href=# id=sidebar-toggle title=Menu><i class="fas fa-bars fa-fw"></i></a></span>
<span id=toc-menu title="Table of Contents"><i class="fas fa-list-alt fa-fw"></i></span><ol class=links itemscope itemtype=http://schema.org/BreadcrumbList><meta itemprop=itemListOrder content="Descending"><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><meta itemprop=position content="1"><a itemprop=item href=https://choria-io.github.io/asyncjobs/ aria-disabled=true><span itemprop=name>Choria Async Jobs</span></a></li></ol></div><div class="default-animation progress"><div class=wrapper><nav id=TableOfContents><ul><li><a href=#synopsis>Synopsis</a></li></ul></nav></div></div></div></nav><main id=body-inner class=highlightable><div class=flex-block-wrapper><div id=head-tags></div><article><h1 id=introduction>Introduction</h1><p>This is an Asynchronous Job Queue system that relies on NATS JetStream for storage and general job life cycle management. It is compatible with any NATS JetStream based system like a private hosted JetStream, Choria Streams or a commercial SaaS.</p><p>Each Task is stored in JetStream by a unique ID and Work Queue item is made referencing that Task. JetStream will handle dealing with scheduling, retries, acknowledgements and more of the Work Queue item. The stored Task will be updated during the lifecycle.</p><p>Multiple processes can process jobs concurrently, thus job processing is both horizontally and vertically scalable. Job handlers are implemented in Go with one process hosting one or many handlers. Other languages can implement Job Handlers using NATS Request-Reply services. Per process concurrency and overall per-queue concurrency controls exist.</p><h2 id=synopsis>Synopsis</h2><p>Tasks are published to Work Queues:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// establish a connection to the EMAIL work queue using a NATS context
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>client</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>_</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>asyncjobs</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>NewClient</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>asyncjobs</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>NatsConn</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>nc</span><span style=color:#000;font-weight:700>),</span> <span style=color:#000>asyncjobs</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>BindWorkQueue</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;EMAIL&#34;</span><span style=color:#000;font-weight:700>))</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// create a task with the type &#39;email:new&#39; and body from newEmail()
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>task</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>_</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>asyncjobs</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>NewTask</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;email:new&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>newEmail</span><span style=color:#000;font-weight:700>())</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// store it in the Work Queue
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>client</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>EnqueueTask</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>ctx</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>task</span><span style=color:#000;font-weight:700>)</span>
</span></span></code></pre></div><p>Tasks are processes by horizontally and vertically scalable processes. Typically, a Handler handles one type of Task. We have Prometheus
integration, concurrency and backoffs configured.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// establish a connection to the EMAIL work queue using a 
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// NATS context, with concurrency, prometheus stats and backoff
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>client</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>_</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>asyncjobs</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>NewClient</span><span style=color:#000;font-weight:700>(</span>
</span></span><span style=display:flex><span>	<span style=color:#000>asyncjobs</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>NatsContext</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;EMAIL&#34;</span><span style=color:#000;font-weight:700>),</span> 
</span></span><span style=display:flex><span>	<span style=color:#000>asyncjobs</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>BindWorkQueue</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;EMAIL&#34;</span><span style=color:#000;font-weight:700>),</span>
</span></span><span style=display:flex><span>	<span style=color:#000>asyncjobs</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>ClientConcurrency</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#000;font-weight:700>),</span>
</span></span><span style=display:flex><span>	<span style=color:#000>asyncjobs</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>PrometheusListenPort</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>8080</span><span style=color:#000;font-weight:700>),</span>
</span></span><span style=display:flex><span>	<span style=color:#000>asyncjobs</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>RetryBackoffPolicy</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>asyncjobs</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>RetryLinearTenMinutes</span><span style=color:#000;font-weight:700>))</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000>router</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>asyncjobs</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>NewTaskRouter</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span><span style=color:#000>router</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Handler</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;email:new&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>ctx</span> <span style=color:#000>context</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Context</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>log</span> <span style=color:#000>asyncjobs</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Logger</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>task</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>asyncjobs</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Task</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>interface</span><span style=color:#000;font-weight:700>{},</span> <span style=color:#204a87;font-weight:700>error</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>	<span style=color:#000>log</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Printf</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;Processing task %s&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>task</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>ID</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#8f5902;font-style:italic>// do work here using task.Payload
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>return</span> <span style=color:#4e9a06>&#34;sent&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#204a87;font-weight:700>nil</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>})</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000>client</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Run</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>ctx</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>router</span><span style=color:#000;font-weight:700>)</span>
</span></span></code></pre></div><footer class=footline></footer></article></div></main></div><aside id=sidebar class=default-animation><div id=header-wrapper class=default-animation><div id=header class=default-animation><img src=https://choria-io.github.io/asyncjobs/logo.png></div><div class="searchbox default-animation"><label for=search-by><i class="fas fa-search"></i></label>
<input data-search-input id=search-by type=search placeholder=Search...>
<span data-search-clear><i class="fas fa-times"></i></span></div><script src=https://choria-io.github.io/asyncjobs/js/lunr.min.js?1654500095></script>
<script src=https://choria-io.github.io/asyncjobs/js/auto-complete.js?1654500095></script>
<script src=https://choria-io.github.io/asyncjobs/js/search.js?1654500095></script></div><div id=homelinks class=default-animation><ul><li><a class=padding href=https://choria-io.github.io/asyncjobs/><i class="fas fa-home"></i> Home</a></li></ul></div><div id=content-wrapper class=highlightable><ul class=topics><li data-nav-id=/overview/ title=Overviews class="dd-item alwaysopen"><input type=checkbox id=section-d777480ed79062ea8f809a7116e81e75 class=toggle checked><label for=section-d777480ed79062ea8f809a7116e81e75></label><a href=https://choria-io.github.io/asyncjobs/overview/>Overviews</a><ul><li data-nav-id=/overview/golang-overview/ title="Golang Walkthrough" class=dd-item><a href=https://choria-io.github.io/asyncjobs/overview/golang-overview/>Golang Walkthrough</a></li><li data-nav-id=/overview/cli-overview/ title="CLI Walkthrough" class=dd-item><a href=https://choria-io.github.io/asyncjobs/overview/cli-overview/>CLI Walkthrough</a></li><li data-nav-id=/overview/scheduled-tasks/ title="Scheduled Tasks" class=dd-item><a href=https://choria-io.github.io/asyncjobs/overview/scheduled-tasks/>Scheduled Tasks</a></li><li data-nav-id=/overview/handlers-docker/ title="Handlers in Docker" class=dd-item><a href=https://choria-io.github.io/asyncjobs/overview/handlers-docker/>Handlers in Docker</a></li><li data-nav-id=/overview/handlers-k8s/ title="Handlers in K8s" class=dd-item><a href=https://choria-io.github.io/asyncjobs/overview/handlers-k8s/>Handlers in K8s</a></li><li data-nav-id=/overview/features/ title="Feature List" class=dd-item><a href=https://choria-io.github.io/asyncjobs/overview/features/>Feature List</a></li></ul></li><li data-nav-id=/reference/ title=References class="dd-item alwaysopen"><input type=checkbox id=section-2239954301764a827b7fd6ccce9a99d7 class=toggle checked><label for=section-2239954301764a827b7fd6ccce9a99d7></label><a href=https://choria-io.github.io/asyncjobs/reference/>References</a><ul><li data-nav-id=/reference/task-lifecycle/ title="Tasks lifecycle" class=dd-item><a href=https://choria-io.github.io/asyncjobs/reference/task-lifecycle/>Tasks lifecycle</a></li><li data-nav-id=/reference/routing-concurrency-retry/ title="Routing, Concurrency, Retry" class=dd-item><a href=https://choria-io.github.io/asyncjobs/reference/routing-concurrency-retry/>Routing, Concurrency, Retry</a></li><li data-nav-id=/reference/request-reply/ title="Request-Reply Handlers" class=dd-item><a href=https://choria-io.github.io/asyncjobs/reference/request-reply/>Request-Reply Handlers</a></li><li data-nav-id=/reference/lifecycle-events/ title="Lifecycle Events" class=dd-item><a href=https://choria-io.github.io/asyncjobs/reference/lifecycle-events/>Lifecycle Events</a></li><li data-nav-id=/reference/terminology/ title=Terminology class=dd-item><a href=https://choria-io.github.io/asyncjobs/reference/terminology/>Terminology</a></li></ul></li></ul><div id=shortcuts><div class=nav-title>More</div><ul><li><a class=padding href=https://github.com/choria-io/asyncjobs><i class="fab fa-fw fa-github"></i> GitHub</a></li><li><a class=padding href=https://github.com/choria-io/asyncjobs/releases><i class="far fa-save"></i> Download</a></li><li><a class=padding href=https://github.com/choria-io/asyncjobs/discussions><i class="far fa-comments"></i> Discussions</a></li><li><a class=padding href=https://github.com/choria-io/asyncjobs/issues><i class="far fa-life-ring"></i> Issues</a></li><li><a class=padding href=https://slack.puppet.com/><i class="fab fa-slack"></i> #choria</a></li></ul></div><div class="footermargin footerLangSwitch footerVariantSwitch footerVisitedLinks footerFooter showFooter"></div><hr class="default-animation footerLangSwitch footerVariantSwitch footerVisitedLinks footerFooter showFooter"><div id=prefooter class="footerLangSwitch footerVariantSwitch footerVisitedLinks"><ul><li id=select-language-container class=footerLangSwitch><a class="padding select-container"><i class="fas fa-language fa-fw"></i>
<span>&nbsp;</span><div class=select-style><select id=select-language onchange="location=baseUri+this.value"></select></div><div class=select-clear></div></a></li><li id=select-variant-container class=footerVariantSwitch><a class="padding select-container"><i class="fas fa-paint-brush fa-fw"></i>
<span>&nbsp;</span><div class=select-style><select id=select-variant onchange=variants.changeVariant(this.value)><option id=asyncjobs value=asyncjobs selected>Asyncjobs</option></select></div><div class=select-clear></div></a><script>variants.markSelectedVariant()</script></li><li class=footerVisitedLinks><a class=padding href=# data-clear-history-toggle><i class="fas fa-history fa-fw"></i> Clear History</a></li></ul></div><div id=footer class="footerFooter showFooter"><p>Built with <a href=https://github.com/McShelby/hugo-theme-relearn><i class="fas fa-heart"></i></a> by <a href=https://gohugo.io/>Hugo</a></p></div></div></aside><script src=https://choria-io.github.io/asyncjobs/js/clipboard.min.js?1654500095></script>
<script src=https://choria-io.github.io/asyncjobs/js/perfect-scrollbar.min.js?1654500095></script>
<script src=https://choria-io.github.io/asyncjobs/js/featherlight.min.js?1654500095></script>
<script src=https://choria-io.github.io/asyncjobs/js/theme.js?1654500095></script></body></html>